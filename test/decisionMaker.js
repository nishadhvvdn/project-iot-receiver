var expect = require("chai").expect;
var decisionMaker = require('../routes/decisionMaker.js');

describe("decision Maker\n ",function(){
	//this.timeout(50000);
	this.timeout(10000);	
	
	it("Alarm/Events",function(done){
		decisionMaker.decsionMaker('00001f00010000000100000085010007323031372d30362d30352031313a35343a35374000000000000000084d', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
	 				expect(res).to.equal("DB Events/Alarms inserted");			
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
			}, done,1500 );	
			});
	})
	
	it("OnDemand",function(done){
		decisionMaker.decsionMaker('0000bf01330000000e0000000302010a090001144e6343b81e853d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001273', function (err, res) {
				 setTimeout( function () {
					try {
						//if (err) { done(err); }
					result = 'OnDemand_Webservice: Success';
					expect(res).to.equal(result);
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done, 1 );	
			});
	})
	
	it("COMBINED_TRANSACTIONAL_DATA",function(done){
		decisionMaker.decsionMaker('0000b805bb0000000100000003030407c3f56343f6e86c4300406c4300000000000000000000000000000000713da0417b14a041f628a041295c8d41000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cdec914348e1a542333333431f859d42713d81429a99a942cd8c1d43b81e764248e1be417b1496411f8589410000000007000000030000000a0000000c00000008000000b6000000d400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b0000000d00000008000000c9000000eb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d0070000000000d0070000000000f0070f321c0000d0070000000000d00700000000000000000000000000000000000000000000000000d0070000000000d0070000000000d0070000000000d0070000000000d00700000000000000000000000000000000000000000000000000d0070000000000d0070000000000f0070f321c0000d0070000000000d007000000323031372d35002d31392039003a31343a33310600080100020a00077fea64431d5a843f00000000000000000000000000000000000000001baf47421baf47421baf474200000000000000000000000000000000be9feb42000000005eba95405eba95408d976640df4f95400000000083c08a3e000000000000000083c08a3e00000000db79184304569241a69b4142df8fab4200000000931814403f35be3f1b2fcd3f931814400000000039b4083f000000000000000039b4083f000000007d5601004bbd010034cc010000000000fddf0400b09d0200b09d0200b09d0200b09d0200b09d0200000000009c5302009c5302009c5302009c5302009c5302009403000094030000940300009403000094030000000000000eaf0200aae70200aff002009c530200d5660500b29d0200b29d0200b29d0200b29d0200b29d020023c90200aa000000aa000000aa000000aa000000aa0000001c02d0071422231c02d0071422231c02d0071422231c02d0071422231c02d007142223aa000000aa000000aa000000aa000000aa0000001c02d0071422231c02d0071422231c02d0071422231c02d0071422231c02d007142223aa000000aa000000aa000000aa000000aa0000001c02d0071422231c02d0071422231c02d0071422231c02d0071422231c02d007142223323030302d30322d32382032303a33343a333508000779c96243000000000000000000000000000000000000000096430b3d58b9474258b9474258b9474200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aa000000aa000000aa000000aa000000aa0000001205e1070f26241205e1070f26241205e1070f26241205e1070f26241205e1070f2624aa000000aa000000aa000000aa000000aa0000001205e1070f26241205e1070f26241205e1070f26241205e1070f26241205e1070f2624aa000000aa000000aa000000aa000000aa0000001205e1070f26241205e1070f26241205e1070f26241205e1070f26241205e1070f2624323031372d30352d31382031353a33383a333636db', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
					 result = 'Bulk Data';
					//result = 'Transaction Data Inserted to DB';
					expect(res).to.equal(result);				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})
	
	it("Managerial Data -- HS Registeration",function(done){
		decisionMaker.decsionMaker('00003d000000000001000000010130303030303030303030303030303043454c4c335f54455354689e19d12b1c48532d30303030303030303030303030303043454c4c335f544553548f32', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
						expect(res).to.equal("Webservice: Success");				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})
	
	it("Managerial Data -- Meter Registeration",function(done){
		decisionMaker.decsionMaker('000021000000000001000000020130303030303030303030303030303030303635343030323439689e19155319d4f1', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
						expect(res).to.equal("Webservice: Success");				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})

	it("Invalid CRC",function(done){
		decisionMaker.decsionMaker('00003d000000000001000000010130303030303030303030303030303043454c4c335f54455354689e19d12b1c48532d30303030303030303030303030303043454c4c335f544553548f31', function (err, res) {
				 setTimeout( function () {
					try {
					result = 'Incorrect CRC';
					expect(err.message).to.equal(result);				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})
	
	it("Meter Deregistration",function(done){
		decisionMaker.decsionMaker('0000060001000000000100010801010001013a84', function (err, res) {
			setTimeout( function () {
			try {
					if (err) { done(err); }
						done();				 
				} catch(exc) {
					done(exc);
				}	
			}, done,1500 );				
			});
	}) 
	
	it("Node Ping positive response",function(done){
		decisionMaker.decsionMaker('000002004000000001000100890167a8', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
						expect(res).to.equal("Webservice: Success");				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})
	
	it("Node Ping negative (NACK) response",function(done){
		decisionMaker.decsionMaker('0000020039000000010001008981fd46', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
						expect(res).to.equal("Webservice: Success");				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})
	
	it("HS CONFIGURATION Response",function(done){
		decisionMaker.decsionMaker('0000030000000000010000008a0301d8e9', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
						expect(res).to.equal("Webservice: Success");				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})
	
	/*it("Meter CONFIGURATION NACK Response",function(done){ //Webservice error
		decisionMaker.decsionMaker('000003000000000001000b008a84026b5d', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
						expect(res).to.equal("Webservice: Success");				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})*/
	
	it("HYPERSPROUT WIFI Response",function(done){
		decisionMaker.decsionMaker('00000300d6000000010000008a02012c2b', function (err, res) {
				 setTimeout( function () {
					try {
						if (err) { done(err); }
					expect(res).to.equal("Webservice: Success");				
	 				done();				 
	 			} catch(exc) {
	 				done(exc);
	 			}					
				}, done,1500 );	
			});
	})

});